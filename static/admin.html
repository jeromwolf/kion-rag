<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì - KION RAG</title>
    <style>
        :root {
            --primary: #1565C0;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
            --dark: #333;
            --gray: #666;
            --light: #f5f5f5;
            --white: #fff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            background: var(--light);
            color: var(--dark);
        }

        .header {
            background: var(--white);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 0 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-inner {
            max-width: 1200px;
            margin: 0 auto;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--success));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
        }

        .logo-text span { color: var(--primary); }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-links a {
            color: var(--gray);
            text-decoration: none;
            font-size: 14px;
            padding: 8px 16px;
            border-radius: 6px;
        }

        .nav-links a:hover, .nav-links a.active {
            background: var(--light);
            color: var(--primary);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .page-title {
            margin-bottom: 30px;
        }

        .page-title h1 {
            font-size: 28px;
            color: var(--dark);
        }

        .page-title p {
            color: var(--gray);
            margin-top: 8px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background: var(--white);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .card h3 {
            font-size: 16px;
            color: var(--dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-grid {
            display: grid;
            gap: 12px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--light);
            border-radius: 8px;
        }

        .status-label {
            font-size: 14px;
            color: var(--gray);
        }

        .status-value {
            font-size: 14px;
            font-weight: 600;
        }

        .status-value.success { color: var(--success); }
        .status-value.warning { color: var(--warning); }
        .status-value.danger { color: var(--danger); }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover { background: #1255A1; }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border: 1px solid #ddd;
        }

        .btn-secondary:hover { background: #eee; }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover { background: #D32F2F; }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .action-grid {
            display: grid;
            gap: 12px;
        }

        .action-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: var(--light);
            border-radius: 8px;
        }

        .action-info h4 {
            font-size: 14px;
            color: var(--dark);
            margin-bottom: 4px;
        }

        .action-info p {
            font-size: 12px;
            color: var(--gray);
        }

        .log-box {
            background: #263238;
            color: #ECEFF1;
            padding: 16px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .log-box .log-entry {
            margin-bottom: 4px;
        }

        .log-box .log-time {
            color: #78909C;
        }

        .log-box .log-success { color: #81C784; }
        .log-box .log-error { color: #EF5350; }
        .log-box .log-info { color: #64B5F6; }

        .stats-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
        }

        .stats-label {
            font-size: 14px;
            color: var(--gray);
            margin-top: 4px;
        }

        .refresh-time {
            font-size: 12px;
            color: var(--gray);
            text-align: right;
            margin-top: 16px;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-inner">
            <a href="/" class="logo">
                <div class="logo-icon">K</div>
                <div class="logo-text"><span>KION</span> RAG</div>
            </a>
            <nav class="nav-links">
                <a href="/">í™ˆ</a>
                <a href="/static/architecture.html">ì•„í‚¤í…ì²˜</a>
                <a href="/static/techstack.html">ê¸°ìˆ ìŠ¤íƒ</a>
                <a href="/static/data-design.html">ë°ì´í„°ì„¤ê³„</a>
                <a href="/static/implementation.html">êµ¬í˜„ê°€ì´ë“œ</a>
                <a href="/static/admin.html" class="active">ê´€ë¦¬ì</a>
                <a href="/static/api-docs.html">API ë¬¸ì„œ</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="page-title">
            <h1>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
            <p>ì‹œìŠ¤í…œ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ë° ë°ì´í„° ê´€ë¦¬</p>
        </div>

        <div class="grid">
            <!-- ì‹œìŠ¤í…œ ìƒíƒœ -->
            <div class="card">
                <h3>ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ</h3>
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">API ì„œë²„</span>
                        <span class="status-value success" id="api-status">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Ollama (LLM)</span>
                        <span class="status-value" id="ollama-status">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ChromaDB (ë²¡í„°DB)</span>
                        <span class="status-value" id="chroma-status">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ì¥ë¹„ ë°ì´í„°</span>
                        <span class="status-value" id="equipment-count">-</span>
                    </div>
                </div>
                <p class="refresh-time" id="last-refresh">ë§ˆì§€ë§‰ ê°±ì‹ : -</p>
            </div>

            <!-- ë°ì´í„° ê´€ë¦¬ -->
            <div class="card">
                <h3>ğŸ—„ï¸ ë°ì´í„° ê´€ë¦¬</h3>
                <div class="action-grid">
                    <div class="action-item">
                        <div class="action-info">
                            <h4>ë°ì´í„° ë¦¬ë¡œë“œ</h4>
                            <p>JSON íŒŒì¼ì—ì„œ ì¥ë¹„ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ</p>
                        </div>
                        <button class="btn btn-primary" id="btn-reload" onclick="reloadData()">
                            ğŸ”„ ë¦¬ë¡œë“œ
                        </button>
                    </div>
                    <div class="action-item">
                        <div class="action-info">
                            <h4>ìºì‹œ ì´ˆê¸°í™”</h4>
                            <p>LLM ì‘ë‹µ ìºì‹œ ì‚­ì œ (TTL 5ë¶„)</p>
                        </div>
                        <button class="btn btn-secondary" id="btn-cache" onclick="clearCache()">
                            ğŸ—‘ï¸ ì´ˆê¸°í™”
                        </button>
                    </div>
                    <div class="action-item">
                        <div class="action-info">
                            <h4>í”„ë¡¬í”„íŠ¸ ë¦¬ë¡œë“œ</h4>
                            <p>ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ íŒŒì¼ ë‹¤ì‹œ ë¡œë“œ</p>
                        </div>
                        <button class="btn btn-secondary" id="btn-prompt" onclick="reloadPrompts()">
                            ğŸ“ ë¦¬ë¡œë“œ
                        </button>
                    </div>
                </div>
            </div>

            <!-- í†µê³„ -->
            <div class="card">
                <h3>ğŸ“ˆ í†µê³„</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: center;">
                    <div>
                        <div class="stats-number" id="stats-equipment">-</div>
                        <div class="stats-label">ë“±ë¡ ì¥ë¹„</div>
                    </div>
                    <div>
                        <div class="stats-number" id="stats-categories">-</div>
                        <div class="stats-label">ì¹´í…Œê³ ë¦¬</div>
                    </div>
                </div>
            </div>

            <!-- ì‘ì—… ë¡œê·¸ -->
            <div class="card">
                <h3>ğŸ“‹ ì‘ì—… ë¡œê·¸</h3>
                <div class="log-box" id="log-box">
                    <div class="log-entry">
                        <span class="log-time">[ì‹œìŠ¤í…œ]</span>
                        <span class="log-info">ê´€ë¦¬ì í˜ì´ì§€ ë¡œë“œë¨</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- í–¥í›„ ê¸°ëŠ¥ -->
        <div class="card" style="margin-top: 20px;">
            <h3>ğŸš€ í–¥í›„ ì¶”ê°€ ì˜ˆì • ê¸°ëŠ¥</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
                <span style="background: #E3F2FD; color: #1565C0; padding: 8px 16px; border-radius: 20px; font-size: 13px;">MS-SQL ë™ê¸°í™”</span>
                <span style="background: #E3F2FD; color: #1565C0; padding: 8px 16px; border-radius: 20px; font-size: 13px;">ì¥ë¹„ ë°ì´í„° í¸ì§‘</span>
                <span style="background: #E3F2FD; color: #1565C0; padding: 8px 16px; border-radius: 20px; font-size: 13px;">ì‚¬ìš©ì í”¼ë“œë°± ì¡°íšŒ</span>
                <span style="background: #E3F2FD; color: #1565C0; padding: 8px 16px; border-radius: 20px; font-size: 13px;">ì§ˆì˜ ë¡œê·¸ ë¶„ì„</span>
                <span style="background: #E3F2FD; color: #1565C0; padding: 8px 16px; border-radius: 20px; font-size: 13px;">í”„ë¡¬í”„íŠ¸ í¸ì§‘ê¸°</span>
            </div>
        </div>
    </div>

    <script>
        // ì‹œìŠ¤í…œ ìƒíƒœ ì²´í¬
        async function checkHealth() {
            try {
                const res = await fetch('/health');
                const data = await res.json();

                document.getElementById('api-status').textContent = 'ì •ìƒ';
                document.getElementById('api-status').className = 'status-value success';

                document.getElementById('ollama-status').textContent =
                    data.ollama_status === 'connected' ? 'ì—°ê²°ë¨' : 'ì—°ê²° ì•ˆë¨';
                document.getElementById('ollama-status').className =
                    'status-value ' + (data.ollama_status === 'connected' ? 'success' : 'danger');

                document.getElementById('chroma-status').textContent =
                    data.chroma_status === 'connected' ? 'ì—°ê²°ë¨' : 'ì—°ê²° ì•ˆë¨';
                document.getElementById('chroma-status').className =
                    'status-value ' + (data.chroma_status === 'connected' ? 'success' : 'danger');

                document.getElementById('equipment-count').textContent = data.equipment_count + 'ëŒ€';
                document.getElementById('equipment-count').className = 'status-value success';

                document.getElementById('stats-equipment').textContent = data.equipment_count;

                document.getElementById('last-refresh').textContent =
                    'ë§ˆì§€ë§‰ ê°±ì‹ : ' + new Date().toLocaleTimeString();

            } catch (e) {
                document.getElementById('api-status').textContent = 'ì˜¤ë¥˜';
                document.getElementById('api-status').className = 'status-value danger';
                addLog('API ì—°ê²° ì‹¤íŒ¨: ' + e.message, 'error');
            }
        }

        // ë°ì´í„° ë¦¬ë¡œë“œ
        async function reloadData() {
            const btn = document.getElementById('btn-reload');
            btn.disabled = true;
            btn.textContent = 'ì²˜ë¦¬ ì¤‘...';

            try {
                const res = await fetch('/equipment/reload', { method: 'POST' });
                const data = await res.json();
                addLog(`ë°ì´í„° ë¦¬ë¡œë“œ ì™„ë£Œ: ${data.count}ê°œ ì¥ë¹„`, 'success');
                checkHealth();
            } catch (e) {
                addLog('ë°ì´í„° ë¦¬ë¡œë“œ ì‹¤íŒ¨: ' + e.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸ”„ ë¦¬ë¡œë“œ';
            }
        }

        // ìºì‹œ ì´ˆê¸°í™”
        async function clearCache() {
            const btn = document.getElementById('btn-cache');
            btn.disabled = true;

            try {
                const res = await fetch('/cache/clear', { method: 'POST' });
                if (res.ok) {
                    addLog('ìºì‹œ ì´ˆê¸°í™” ì™„ë£Œ', 'success');
                } else {
                    addLog('ìºì‹œ ì´ˆê¸°í™” API ë¯¸êµ¬í˜„', 'info');
                }
            } catch (e) {
                addLog('ìºì‹œ ì´ˆê¸°í™”: API ë¯¸êµ¬í˜„ (í–¥í›„ ì¶”ê°€)', 'info');
            } finally {
                btn.disabled = false;
            }
        }

        // í”„ë¡¬í”„íŠ¸ ë¦¬ë¡œë“œ
        async function reloadPrompts() {
            const btn = document.getElementById('btn-prompt');
            btn.disabled = true;

            try {
                const res = await fetch('/prompts/reload', { method: 'POST' });
                if (res.ok) {
                    addLog('í”„ë¡¬í”„íŠ¸ ë¦¬ë¡œë“œ ì™„ë£Œ', 'success');
                } else {
                    addLog('í”„ë¡¬í”„íŠ¸ ë¦¬ë¡œë“œ API ë¯¸êµ¬í˜„', 'info');
                }
            } catch (e) {
                addLog('í”„ë¡¬í”„íŠ¸ ë¦¬ë¡œë“œ: API ë¯¸êµ¬í˜„ (í–¥í›„ ì¶”ê°€)', 'info');
            } finally {
                btn.disabled = false;
            }
        }

        // ë¡œê·¸ ì¶”ê°€
        function addLog(message, type = 'info') {
            const logBox = document.getElementById('log-box');
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `<span class="log-time">[${time}]</span> <span class="log-${type}">${message}</span>`;
            logBox.insertBefore(entry, logBox.firstChild);
        }

        // ì´ˆê¸°í™”
        checkHealth();

        // ì¹´í…Œê³ ë¦¬ ìˆ˜ ì„ì‹œ ì„¤ì • (í–¥í›„ API ì—°ë™)
        document.getElementById('stats-categories').textContent = '12';

        // 30ì´ˆë§ˆë‹¤ ìë™ ê°±ì‹ 
        setInterval(checkHealth, 30000);
    </script>

    <footer style="text-align: center; padding: 40px; color: var(--gray); font-size: 14px;" class="no-print">
        <button onclick="savePDF()" style="background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; margin-bottom: 20px; display: inline-flex; align-items: center; gap: 8px;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            PDF ì €ì¥
        </button>
        <p>KION RAG PoC - AI ë°˜ë„ì²´ ì¥ë¹„ ì¶”ì²œ ì‹œìŠ¤í…œ</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        function savePDF() {
            const element = document.querySelector('.container');
            const opt = {
                margin: 10,
                filename: 'KION_RAG_ê´€ë¦¬ì.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
                pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
            };
            html2pdf().set(opt).from(element).save();
        }
    </script>

    <style>
        @media print {
            .header, .no-print { display: none !important; }
            .container { padding-top: 0 !important; }
            body { background: white; }
        }
    </style>
</body>
</html>
