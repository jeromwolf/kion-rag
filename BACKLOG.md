# KION RAG - 백로그

## 우선순위 높음 (다음 작업)

> **배경**: 다른 부분들은 충분히 논의/문서화됨.
> Policy DB와 Improvement는 다이어그램에만 있고 **상세 설계가 미흡**함.

---

### 1. Policy DB 상세 설계 ✅ 완료
- [x] **기관 우선순위 테이블** - `institution_priority.json`
- [x] **정책 설정 테이블** - `policy_settings.json`
- [x] **공정↔장비 매핑 테이블** - `process_equipment_mapping.json`
- [x] **Python 구현** - `app/policy.py`
- [x] **기존 코드 통합** - query_parser.py, filters.py, main.py

### 1-1. 고객사 확인 필요 체크리스트 ⚠️

> **Policy DB 관련 데이터 소스 및 요구사항 확인 필요**

#### 공정↔장비 매핑
- [ ] KION에 기존 공정-장비 매핑 테이블이 있는가?
- [ ] 있다면 어떤 형태인가? (DB 테이블? 엑셀?)
- [ ] 없다면 누가 정의하나? (관리자? 도메인 전문가?)
- [ ] 매핑 추가/수정 주기는? (수시? 분기?)

#### 기관 우선순위
- [ ] 기관 목록 데이터 소스는? (KION DB? 별도 관리?)
- [ ] 우선순위 기준은 누가 정하나?
- [ ] 기관 추가/변경 시 프로세스는?

#### 정책 설정
- [ ] 어떤 정책이 더 필요한가?
- [ ] 정책 변경 권한은 누구에게?

#### 사용자 권한
- [ ] 권한 구조는? (기관 소속 기반? 등급 기반? 승인 기반?)
- [ ] 사용자 정보는 어디서 가져오나? (SSO? KION 회원DB?)
- [ ] 장비별 접근 제한이 필요한가?

#### 관리자 화면
- [ ] 웹 UI로 CRUD 필요한가?
- [ ] JSON 직접 편집으로 충분한가?
- [ ] 관리자 접근 권한 범위는?

---

---

### 2. IMPROVEMENT 알고리즘 설계
- [ ] **임베딩 튜닝 알고리즘**
  - 👎 피드백 수집 → 오답 쿼리-장비 쌍 분석
  - Hard Negative Mining 로직
  - 주기적 Fine-tuning 트리거 (월 1회 또는 N건 누적)

- [ ] **룰 개선 알고리즘**
  - 오답 패턴 분석 → 누락된 매핑 자동 발견
  - 관리자에게 룰 추가 제안
  - 공정↔장비 매핑 자동 학습

- [ ] **프롬프트 A/B 테스트**
  - 프롬프트 버전 관리
  - 트래픽 분배 로직
  - 성능 비교 메트릭 (정확도, 관련성)
  - 우승 버전 자동 적용

---

## 문서 보완 필요

### 2. 예약 딥링크 연동
- [ ] fab.kion.or.kr 예약 URL 구조 분석
- [ ] 장비 상세 페이지 딥링크 생성 로직
- [ ] 참고: https://www.kion.or.kr/hm/equipReservation/list

### 3. 평가 기준/메트릭
- [ ] Recall@K 측정 방법 문서화
- [ ] 엣지케이스 테스트 시나리오 정의
- [ ] 품질 평가 체크리스트 작성

### 4. 쿼리 파서 상세
- [ ] 정규식 + NER 수치/단위 변환 상세 설계
- [ ] "6 inch, 4인치, 150mm" 표준화 로직 구현
- [ ] 온도, 압력 단위 변환

### 5. LLM 컨텍스트 포맷
- [ ] 장비 정보 통일 포맷 예시 작성
- [ ] 프롬프트 템플릿 표준화

---

## 참고 URL
- KION 팹서비스: https://www.kion.or.kr/hm/equipReservation/list
- fab.kion.or.kr (예약 시스템)

---

## 완료된 항목
- [x] 아키텍처 문서 (A, B-1, B-2)
- [x] 기술스택 문서
- [x] 데이터설계 문서
- [x] 구현가이드 문서
- [x] 관리자 페이지 (프롬프트 관리, 정책/룰 관리)
- [x] 전체 아키텍처 다이어그램
- [x] Policy DB 섹션
- [x] Improvement 섹션 (UI만)
- [x] Vercel 배포
- [x] **Policy DB 상세 설계 및 구현** (2025-12-29)
  - 기관 우선순위, 정책 설정, 공정-장비 매핑
  - 기존 RAG 파이프라인 통합 완료

---

*마지막 업데이트: 2025-12-29*
